
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>XML-RPC using scala - Ouertani Blog</title>
  <meta name="author" content="Ouertani">

  
  <meta name="description" content="UCIP Scala driver using XML/RPC">
  <meta name="keywords" content="Scala, XML, Ucip, RPC">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://ouertani.github.io/blog/2012/06/29/xml-rpc-using-scala">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Ouertani Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-39743923-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner">
</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:ouertani.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<!-- use full url including 'index.html' for navigation bar if you are using ajax -->
<ul id="nav">
	<li id="ajax"><a href="/index.html">Home</a></li>
	<li id="ajax"><a href="/blog/archives/index.html">Archives</a></li>
    <li><a href="/atom.xml">RSS</a></li>
    
    <li>
    <div id="dark">
        <form method="get" action="/search.html" id="search">
            <input name="query" type="text" placeholder="Search..." x-webkit-speech />
        </form>
    </div>
    </li>
        
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">XML-RPC Using Scala</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-06-29T02:03:00+02:00" pubdate data-updated="true">Jun 29<span>th</span>, 2012</time>
        
      </p>
    
  </header>


<div class="entry-content"><h2>Purpose</h2>


<p>Calling remote procedure using XML-RPC and Scala.</p>

<h2>Introduction</h2>


<p>On Telecom IT environment and specially middelware solution, we will rarely do all the work but rather delegate some of business process to other tiers. Web service communications is heavy used between solutions. However, many IT node continues to support older protocols like XML-RPC. Ericsson Intelligent Network (IN) and its subsystem uses AIR Integration Protocol user communication(UCIP) based on a variant of XM-RPC.</p>

<!-- more -->


<h2>Why UCIP ?</h2>


<p>UCIP is intended for user self services such as Adjustments, Account Refill, and Account Inquiries and to extract account details. UCIP is an IP-based protocol used for integration towards the AIR server from the external application.</p>

<h2>Why Scala ?</h2>


<p>UCIP is an XML over HTTP based protocol, which makes it easy to integrate with a central integration point within a network. In addition, Scala can be used to easily create, parse, and process XML documents. XML data can be represented in Scala either by using a generic data representation, or with a data-specific data representation.</p>

<h2>Scala & XML-RPC</h2>


<p>Rather than using an precompiled version of XML-RPC library, we will do our home solution using httpclient library from apache :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;dependency&gt;</span>
</span><span class='line'> <span class="nt">&lt;groupId&gt;</span>org.apache.httpcomponents<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'> <span class="nt">&lt;artifactId&gt;</span>httpclient<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'> <span class="nt">&lt;version&gt;</span>4.1<span class="nt">&lt;/version&gt;</span>
</span><span class='line'><span class="nt">&lt;/dependency&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>UPDATEBALANCEANDDATE</h3>


<p>The message UpdateBalanceAndDate is used to adjust balances and expiry dates on the main account and the dedicated accounts. The sample I chooses here is only to update main balance :</p>

<p>Let&rsquo;s start with some helpful class :</p>

<p>1- InParameters class : contains In specific configuration like ip and port</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">case</span> <span class="k">class</span> <span class="nc">InParameters</span><span class="o">(</span><span class="n">ip</span><span class="k">:</span><span class="kt">String</span><span class="o">,</span><span class="n">port</span><span class="k">:</span><span class="kt">Int</span><span class="o">,</span><span class="n">user</span><span class="k">:</span><span class="kt">String</span><span class="o">,</span><span class="n">pwd</span><span class="k">:</span><span class="kt">String</span><span class="o">,</span><span class="n">agent</span><span class="k">:</span><span class="kt">String</span><span class="o">,</span><span class="n">url</span><span class="k">:</span><span class="kt">String</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>2- XMLRPCVo abstract class : groups all XML request message like the transaction generated Id and date</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">object</span> <span class="nc">XmlRpcVo</span> <span class="o">{</span>
</span><span class='line'> <span class="k">val</span> <span class="n">f</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">SimpleDateFormat</span><span class="o">(</span><span class="s">&quot;yyyyMMdd&#39;T&#39;HH:mm:ssZ&quot;</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="k">abstract</span> <span class="k">class</span> <span class="nc">XmlRpcVo</span> <span class="o">{</span>
</span><span class='line'> <span class="k">def</span> <span class="n">originTransactionID</span> <span class="k">=</span> <span class="nc">System</span> <span class="n">currentTimeMillis</span>
</span><span class='line'> <span class="k">def</span> <span class="n">dateTime</span><span class="k">:</span><span class="kt">String</span><span class="o">=</span> <span class="nc">XmlRpcVo</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">format</span><span class="o">(</span><span class="k">new</span> <span class="nc">Date</span><span class="o">())</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>3- UpdateBalanceAndDateParameter class with extend our XMLRPCVo and contains all data needed by Update main balance operation like subscriber number</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">case</span> <span class="k">class</span> <span class="nc">UpdateBalanceAndDateParameter</span><span class="o">(</span><span class="n">subscriberNumber</span><span class="k">:</span><span class="kt">String</span><span class="o">,</span>
</span><span class='line'> <span class="n">originNodeType</span><span class="k">:</span><span class="kt">String</span><span class="o">,</span>
</span><span class='line'> <span class="n">originHostName</span><span class="k">:</span><span class="kt">String</span><span class="o">,</span>
</span><span class='line'> <span class="n">transactionCurrency</span><span class="k">:</span><span class="kt">String</span><span class="o">,</span>
</span><span class='line'> <span class="n">amount</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">)</span>
</span><span class='line'><span class="k">extends</span> <span class="nc">XmlRpcVo</span>
</span></code></pre></td></tr></table></div></figure>


<p>4-UCIP suggests to add custom header on XML-RPC message. XmlRpcHttpClient class dialogue with IN nodes using generic execute method</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">class</span> <span class="nc">XmlRpcHttpClient</span><span class="o">(</span><span class="n">inp</span> <span class="k">:</span><span class="kt">InParameters</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">LogHelper</span><span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">private</span> <span class="k">val</span> <span class="n">httpclient</span><span class="k">:</span><span class="kt">DefaultHttpClient</span> <span class="o">=</span> <span class="n">client</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">private</span> <span class="o">[</span><span class="kt">this</span><span class="o">]</span> <span class="k">def</span> <span class="n">client</span><span class="o">()</span> <span class="k">=</span>
</span><span class='line'>  <span class="o">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="n">httpclient</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">DefaultHttpClient</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">httpclient</span><span class="o">.</span><span class="n">getCredentialsProvider</span><span class="o">().</span><span class="n">setCredentials</span><span class="o">(</span>
</span><span class='line'>      <span class="k">new</span> <span class="nc">AuthScope</span><span class="o">(</span><span class="n">inp</span><span class="o">.</span><span class="n">ip</span><span class="o">,</span> <span class="n">inp</span><span class="o">.</span><span class="n">port</span><span class="o">),</span>
</span><span class='line'>      <span class="k">new</span> <span class="nc">UsernamePasswordCredentials</span><span class="o">(</span><span class="n">inp</span><span class="o">.</span><span class="n">user</span><span class="o">,</span> <span class="n">inp</span><span class="o">.</span><span class="n">pwd</span><span class="o">))</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="n">httpclient</span><span class="o">.</span><span class="n">getParams</span><span class="o">().</span><span class="n">setParameter</span><span class="o">(</span><span class="nc">CoreProtocolPNames</span><span class="o">.</span><span class="nc">USER_AGENT</span><span class="o">,</span> <span class="n">inp</span><span class="o">.</span><span class="n">agent</span><span class="o">)</span>
</span><span class='line'>    <span class="n">httpclient</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  <span class="k">private</span> <span class="o">[</span><span class="kt">this</span><span class="o">]</span> <span class="k">def</span> <span class="n">poster</span><span class="o">(</span><span class="n">elem</span><span class="k">:</span><span class="kt">Elem</span><span class="o">)</span> <span class="o">={</span>
</span><span class='line'>    <span class="k">val</span> <span class="n">httppost</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">HttpPost</span><span class="o">(</span><span class="n">inp</span><span class="o">.</span><span class="n">url</span><span class="o">)</span>
</span><span class='line'>    <span class="n">httppost</span><span class="o">.</span><span class="n">addHeader</span><span class="o">(</span><span class="s">&quot;Content-Type&quot;</span><span class="o">,</span> <span class="s">&quot;text/xml&quot;</span><span class="o">)</span>
</span><span class='line'>    <span class="n">httppost</span><span class="o">.</span><span class="n">addHeader</span><span class="o">(</span><span class="s">&quot;Content-Disposition&quot;</span><span class="o">,</span> <span class="s">&quot;form-data; name=\&quot;fname\&quot;; filename=\&quot;request.xml\&quot;&quot;</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">comment</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">StringBody</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">+</span><span class="n">elem</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">reqEntity</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MultipartEntity</span><span class="o">()</span>
</span><span class='line'>    <span class="n">reqEntity</span><span class="o">.</span><span class="n">addPart</span><span class="o">(</span><span class="s">&quot;fname&quot;</span><span class="o">,</span> <span class="n">comment</span><span class="o">)</span>
</span><span class='line'>    <span class="n">httppost</span><span class="o">.</span><span class="n">setEntity</span><span class="o">(</span><span class="n">reqEntity</span><span class="o">)</span>
</span><span class='line'>    <span class="n">httppost</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="n">execute</span><span class="o">(</span><span class="n">requestVo</span><span class="k">:</span><span class="kt">scala.xml.Elem</span><span class="o">)</span><span class="k">:</span><span class="kt">HttpResponse</span> <span class="o">=</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">try</span>     <span class="o">{</span> <span class="n">client</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="n">poster</span><span class="o">(</span><span class="n">requestVo</span><span class="o">))}</span>
</span><span class='line'>    <span class="k">catch</span>   <span class="o">{</span> <span class="k">case</span> <span class="n">e</span> <span class="k">=&gt;</span>  <span class="k">throw</span> <span class="k">new</span> <span class="n">connectionExecption</span><span class="o">(</span><span class="n">e</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    <span class="k">finally</span> <span class="o">{</span>  <span class="n">client</span><span class="o">.</span><span class="n">getConnectionManager</span><span class="o">().</span><span class="n">shutdown</span><span class="o">()</span> <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>XML-RPC is a Remote Procedure Calling protocol and the body of an XML-RPC request is formatted using XML. A procedure executes on the AIR server and the value it returns is also formatted in XML. The interface to the AIR server interface uses XML-RPC over HTTP. Sending an XML to update the main balance will be using this class.</p>

<p>5- UpdateBalanceAndDate class : generates an UpdateBalanceAndDate XML request message</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">class</span> <span class="nc">UpdateBalanceAndDate</span> <span class="o">(</span><span class="n">ubdp</span> <span class="k">:</span><span class="kt">UpdateBalanceAndDateParameter</span><span class="o">)</span>  <span class="o">{</span>
</span><span class='line'>    <span class="k">def</span> <span class="n">request</span><span class="k">=</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="n">methodCall</span><span class="o">&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="n">methodName</span><span class="o">&gt;</span><span class="nc">UpdateBalanceAndDate</span><span class="o">&lt;/</span><span class="n">methodName</span><span class="o">&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="n">params</span><span class="o">&gt;</span>
</span><span class='line'>          <span class="o">&lt;</span><span class="n">param</span><span class="o">&gt;</span>
</span><span class='line'>            <span class="o">&lt;</span><span class="n">value</span><span class="o">&gt;</span>
</span><span class='line'>              <span class="o">&lt;</span><span class="n">struct</span><span class="o">&gt;</span>
</span><span class='line'>                <span class="o">&lt;</span><span class="n">member</span><span class="o">&gt;</span>
</span><span class='line'>                  <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="n">originNodeType</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
</span><span class='line'>                  <span class="o">&lt;</span><span class="n">value</span><span class="o">&gt;</span>
</span><span class='line'>                    <span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;{</span><span class="n">ubdp</span><span class="o">.</span><span class="n">originNodeType</span><span class="o">}&lt;/</span><span class="n">string</span><span class="o">&gt;</span>
</span><span class='line'>                  <span class="o">&lt;/</span><span class="n">value</span><span class="o">&gt;</span>
</span><span class='line'>                <span class="o">&lt;/</span><span class="n">member</span><span class="o">&gt;</span>
</span><span class='line'>                <span class="o">&lt;</span><span class="n">member</span><span class="o">&gt;</span>
</span><span class='line'>                  <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="n">originHostName</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
</span><span class='line'>                  <span class="o">&lt;</span><span class="n">value</span><span class="o">&gt;</span>
</span><span class='line'>                    <span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;{</span><span class="n">ubdp</span><span class="o">.</span><span class="n">originHostName</span><span class="o">}&lt;/</span><span class="n">string</span><span class="o">&gt;</span>
</span><span class='line'>                  <span class="o">&lt;/</span><span class="n">value</span><span class="o">&gt;</span>
</span><span class='line'>                <span class="o">&lt;/</span><span class="n">member</span><span class="o">&gt;</span>
</span><span class='line'>                <span class="o">&lt;</span><span class="n">member</span><span class="o">&gt;</span>
</span><span class='line'>                  <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="n">originTransactionID</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
</span><span class='line'>                  <span class="o">&lt;</span><span class="n">value</span><span class="o">&gt;</span>
</span><span class='line'>                    <span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;{</span><span class="n">ubdp</span><span class="o">.</span><span class="n">originTransactionID</span><span class="o">}&lt;/</span><span class="n">string</span><span class="o">&gt;</span>
</span><span class='line'>                  <span class="o">&lt;/</span><span class="n">value</span><span class="o">&gt;</span>
</span><span class='line'>                <span class="o">&lt;/</span><span class="n">member</span><span class="o">&gt;</span>
</span><span class='line'>                <span class="o">&lt;</span><span class="n">member</span><span class="o">&gt;</span>
</span><span class='line'>                  <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="n">originTimeStamp</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
</span><span class='line'>                  <span class="o">&lt;</span><span class="n">value</span><span class="o">&gt;</span>
</span><span class='line'>                    <span class="o">&lt;</span><span class="n">dateTime</span><span class="o">.</span><span class="n">iso8601</span><span class="o">&gt;{</span><span class="n">ubdp</span><span class="o">.</span><span class="n">dateTime</span><span class="o">}&lt;/</span><span class="n">dateTime</span><span class="o">.</span><span class="n">iso8601</span><span class="o">&gt;</span>
</span><span class='line'>                  <span class="o">&lt;/</span><span class="n">value</span><span class="o">&gt;</span>
</span><span class='line'>                <span class="o">&lt;/</span><span class="n">member</span><span class="o">&gt;</span>
</span><span class='line'>                <span class="o">&lt;</span><span class="n">member</span><span class="o">&gt;</span>
</span><span class='line'>                  <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="n">subscriberNumber</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
</span><span class='line'>                  <span class="o">&lt;</span><span class="n">value</span><span class="o">&gt;</span>
</span><span class='line'>                    <span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;{</span><span class="n">ubdp</span><span class="o">.</span><span class="n">subscriberNumber</span><span class="o">}&lt;/</span><span class="n">string</span><span class="o">&gt;</span>
</span><span class='line'>                  <span class="o">&lt;/</span><span class="n">value</span><span class="o">&gt;</span>
</span><span class='line'>                <span class="o">&lt;/</span><span class="n">member</span><span class="o">&gt;</span>
</span><span class='line'>                <span class="o">&lt;</span><span class="n">member</span><span class="o">&gt;</span>
</span><span class='line'>                  <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="n">transactionCurrency</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
</span><span class='line'>                  <span class="o">&lt;</span><span class="n">value</span><span class="o">&gt;</span>
</span><span class='line'>                    <span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;{</span><span class="n">ubdp</span><span class="o">.</span><span class="n">transactionCurrency</span><span class="o">}&lt;/</span><span class="n">string</span><span class="o">&gt;</span>
</span><span class='line'>                  <span class="o">&lt;/</span><span class="n">value</span><span class="o">&gt;</span>
</span><span class='line'>                <span class="o">&lt;/</span><span class="n">member</span><span class="o">&gt;</span>
</span><span class='line'>                <span class="o">&lt;</span><span class="n">member</span><span class="o">&gt;</span>
</span><span class='line'>                  <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="n">adjustmentAmountRelative</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
</span><span class='line'>                  <span class="o">&lt;</span><span class="n">value</span><span class="o">&gt;</span>
</span><span class='line'>                    <span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;{</span><span class="n">ubdp</span><span class="o">.</span><span class="n">amount</span><span class="o">}&lt;/</span><span class="n">string</span><span class="o">&gt;</span>
</span><span class='line'>                  <span class="o">&lt;/</span><span class="n">value</span><span class="o">&gt;</span>
</span><span class='line'>                <span class="o">&lt;/</span><span class="n">member</span><span class="o">&gt;</span>
</span><span class='line'>              <span class="o">&lt;/</span><span class="n">struct</span><span class="o">&gt;</span>
</span><span class='line'>            <span class="o">&lt;/</span><span class="n">value</span><span class="o">&gt;</span>
</span><span class='line'>          <span class="o">&lt;/</span><span class="n">param</span><span class="o">&gt;</span>
</span><span class='line'>        <span class="o">&lt;/</span><span class="n">params</span><span class="o">&gt;</span>
</span><span class='line'>      <span class="o">&lt;/</span><span class="n">methodCall</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>6- UpdateBalanceAndDate companion object is used to parse response and validate the transaction</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">object</span> <span class="nc">UpdateBalanceAndDate</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@throws</span> <span class="o">(</span><span class="n">classOf</span><span class="o">[</span><span class="kt">ClientProtocolException</span><span class="o">])</span>
</span><span class='line'>  <span class="nd">@throws</span> <span class="o">(</span><span class="n">classOf</span><span class="o">[</span><span class="kt">IOException</span><span class="o">])</span>
</span><span class='line'>  <span class="k">def</span>  <span class="n">getResponse</span><span class="o">(</span><span class="n">response</span><span class="k">:</span><span class="kt">HttpResponse</span> <span class="o">)</span><span class="k">:</span><span class="kt">Int</span><span class="o">=</span>  <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">val</span> <span class="n">entity</span> <span class="k">=</span> <span class="n">response</span><span class="o">.</span><span class="n">getEntity</span><span class="o">();</span>
</span><span class='line'>      <span class="k">if</span> <span class="o">(</span><span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">val</span> <span class="n">s</span> <span class="k">=</span> <span class="nc">EntityUtils</span><span class="o">.</span><span class="n">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span>
</span><span class='line'>        <span class="k">val</span> <span class="n">elem</span> <span class="k">=</span>  <span class="nc">XML</span><span class="o">.</span><span class="n">loadString</span><span class="o">(</span><span class="n">s</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">val</span> <span class="n">tuple</span><span class="k">=</span>   <span class="k">for</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">x</span> <span class="k">&lt;-</span> <span class="o">(</span><span class="n">elem</span> <span class="o">\\</span> <span class="s">&quot;member&quot;</span><span class="o">)</span>
</span><span class='line'>          <span class="n">name</span> <span class="k">=</span> <span class="o">(</span><span class="n">x</span> <span class="o">\</span> <span class="s">&quot;name&quot;</span> <span class="o">)</span> <span class="o">.</span><span class="n">text</span>
</span><span class='line'>          <span class="n">code</span> <span class="k">=</span> <span class="o">(</span> <span class="n">x</span>  <span class="o">\</span> <span class="s">&quot;value&quot;</span>  <span class="o">\</span> <span class="s">&quot;i4&quot;</span> <span class="o">).</span><span class="n">text</span>  <span class="k">if</span><span class="o">(</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;responseCode&quot;</span><span class="o">)</span>
</span><span class='line'>            <span class="o">}</span> <span class="k">yield</span> <span class="o">(</span><span class="n">code</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>          <span class="k">if</span><span class="o">(</span><span class="n">tuple</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="o">)</span>  <span class="o">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">tuple</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="n">toInt</span>
</span><span class='line'>          <span class="o">}</span>
</span><span class='line'>          <span class="k">return</span> <span class="nc">RESPONSE_PARSE_EXCEPTION</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="k">else</span> <span class="o">{</span> <span class="k">return</span> <span class="nc">NULL_RESPONSE</span>  <span class="o">}</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>      <span class="k">catch</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">case</span> <span class="k">_</span> <span class="k">=&gt;</span>  <span class="k">return</span>  <span class="nc">UNEXCEPTED_ERROR_WHILE_PARSE_RESPONSE</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>7- UpdateBalanceAndDateController controlleur class orchestrate requests and utilities class</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">class</span> <span class="nc">UpdateBalanceAndDateController</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="n">update</span><span class="o">(</span><span class="n">inp</span><span class="k">:</span> <span class="kt">InParameters</span><span class="o">,</span> <span class="n">ubdp</span> <span class="k">:</span> <span class="kt">UpdateBalanceAndDateParameter</span> <span class="o">)</span><span class="k">:</span><span class="kt">Int</span><span class="o">={</span>
</span><span class='line'>    <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">val</span> <span class="n">c</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">XmlRpcHttpClient</span><span class="o">(</span><span class="n">inp</span><span class="o">)</span>
</span><span class='line'>      <span class="k">val</span> <span class="n">ubd</span> <span class="k">=</span> <span class="k">new</span>  <span class="nc">UpdateBalanceAndDate</span> <span class="o">(</span><span class="n">ubdp</span><span class="o">)</span>
</span><span class='line'>      <span class="k">val</span> <span class="n">rep</span><span class="k">=</span>  <span class="n">c</span> <span class="n">execute</span><span class="o">(</span><span class="n">ubd</span><span class="o">.</span><span class="n">request</span><span class="o">)</span>
</span><span class='line'>      <span class="k">return</span> <span class="nc">UpdateBalanceAndDate</span><span class="o">.</span><span class="n">getResponse</span><span class="o">(</span><span class="n">rep</span> <span class="o">)</span>
</span><span class='line'>    <span class="o">}</span><span class="k">catch</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="n">e</span><span class="k">:</span><span class="kt">connectionExecption</span> <span class="o">=&gt;</span> <span class="k">return</span> <span class="nc">AIR_EXCEPTION</span>
</span><span class='line'>      <span class="k">case</span> <span class="n">e</span> <span class="k">=&gt;</span>  <span class="k">return</span> <span class="nc">UNEXPECTED_CONNECTION__EXCEPTION</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Conclusion</h2>


<p>Create XML message and parse it using scala is like a baby toy and makes using UCIP protocol easier and simpler. This sample can be generalized to the other UCIP messages like GetBalanceAndDate or GetAccountDetails and any other XML-RPC communication.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Ouertani</span></span>

      








  


<time datetime="2012-06-29T02:03:00+02:00" pubdate data-updated="true">Jun 29<span>th</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/scala/'>Scala</a>, <a class='category' href='/blog/categories/ucip/'>Ucip</a>, <a class='category' href='/blog/categories/xml-slash-rpc/'>XML/RPC</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://ouertani.github.io/blog/2012/06/29/xml-rpc-using-scala/" data-via="ouertani" data-counturl="http://ouertani.github.io/blog/2012/06/29/xml-rpc-using-scala/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2012/06/28/jaxws-header-part-2-server-side/" title="Previous Post: Jaxws Header : Part 2 : Server Side">&laquo; Jaxws Header : Part 2 : Server Side</a>
      
      
        <a class="basic-alignment right" href="/blog/2012/09/26/xml-slash-rpc-driver-as-jca-scala-connector/" title="Next Post: XML/RPC driver as JCA Scala connector">XML/RPC driver as JCA Scala connector &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <a href="https://docs.google.com/open?id=0B3c0mmqYdPkobDdhV3ZWbnl2ek0"><img class="center" src="/images/oracle_certprof_clr_rgb.jpg" width="350" height="350" title="score 100%" alt="images"></a>
<a href="https://docs.google.com/file/d/0B3c0mmqYdPkoR1NLMnJwWFB4dmc/preview"><img class="center" src="/images/spring-certification.gif" width="350" height="350" title="score 94%" alt="images"></a>

<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/03/09/rest-with-scala-and-vert-dot-x/">Rest With Scala and Vert.x</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/02/12/fun-with-scala-and-vert-dot-x/">Fun With Scala and Vert.x</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/10/18/getting-started-with-play-2-dot-1/">Play 2.1 Scala 2.10 and String Interpolation</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/10/09/play-2-dot-1/">Play 2.1 , Scala 2.10 and Slick 0.11.1</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/09/26/xml-slash-rpc-driver-as-jca-scala-connector/">XML/RPC Driver as JCA Scala Connector</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/06/29/xml-rpc-using-scala/">XML-RPC Using Scala</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/06/28/jaxws-header-part-2-server-side/">Jaxws Header : Part 2 : Server Side</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/06/28/sending-an-email-using-the-javamail-session-and-glassfish/">Sending an Email Using the JavaMail Session and Glassfish</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/06/27/jax-ws-header-part-1-the-client-side/">JAX-WS Header : Part 1 the Client Side</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/06/24/ee-6-environmental-enterprise-entries-and-glassfish/">EE 6 Environmental Enterprise Entries and Glassfish</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/09/11/basic-mdb-with-scala/">Basic MDB With Scala</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/09/10/basic-ws-with-scala/">Basic WS With Scala</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/06/30/wsdl-integration-problem-two-declarations-cause-a-collision/">WSDL Integration Problem : Two Declarations Cause a Collision</a>
      </li>
    
      <li class="post">
        <a href="/blog/2010/12/06/scala-try-with-resources/">Scala Try-with-resources</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Tag Cloud</h1>
    <span id="tag-cloud"><a href='/blog/categories/glassfish' style='font-size: 107.5%'>Glassfish(1)</a> <a href='/blog/categories/jax-ws' style='font-size: 122.5%'>JAX-WS(3)</a> <a href='/blog/categories/jaxb' style='font-size: 107.5%'>JAXB(1)</a> <a href='/blog/categories/jca' style='font-size: 107.5%'>JCA(1)</a> <a href='/blog/categories/jee' style='font-size: 160.0%'>JEE(8)</a> <a href='/blog/categories/jndi' style='font-size: 107.5%'>JNDI(1)</a> <a href='/blog/categories/mail' style='font-size: 107.5%'>MAIL(1)</a> <a href='/blog/categories/mdb' style='font-size: 107.5%'>MDB(1)</a> <a href='/blog/categories/play' style='font-size: 115.0%'>Play(2)</a> <a href='/blog/categories/rest' style='font-size: 107.5%'>Rest(1)</a> <a href='/blog/categories/rpc' style='font-size: 107.5%'>RPC(1)</a> <a href='/blog/categories/sbt' style='font-size: 107.5%'>Sbt(1)</a> <a href='/blog/categories/scala' style='font-size: 152.5%'>Scala(7)</a> <a href='/blog/categories/scala' style='font-size: 130.0%'>SCALA(4)</a> <a href='/blog/categories/ucip' style='font-size: 115.0%'>Ucip(2)</a> <a href='/blog/categories/vert-x' style='font-size: 115.0%'>Vert.x(2)</a> <a href='/blog/categories/xml' style='font-size: 115.0%'>XML(2)</a> <a href='/blog/categories/xml-rpc' style='font-size: 107.5%'>XML/RPC(1)</a> </span>
</section>

<section>
  
  
    <a href="http://twitter.com/ouertani" class="twitter-follow-button" data-show-count="true">Follow @ouertani</a>
  
</section>





<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/ouertani?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><div style="display:inline">
    Copyright &copy; 2013

    Ouertani
. Powered by <a href="http://octopress.org">Octopress</a> | 
    Theme <a href="http://github.com/panks/fabric">fabric</a> by <a href="http://panks.me">Pankaj Kumar</a>
</div>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'ouertani';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://ouertani.github.io/blog/2012/06/29/xml-rpc-using-scala/';
        var disqus_url = 'http://ouertani.github.io/blog/2012/06/29/xml-rpc-using-scala/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




</body>
</html>
