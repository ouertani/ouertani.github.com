---
layout: post
title: "WSDL integration problem : Two declarations cause a collision"
date: 2011-06-30 04:10
comments: true
categories: [JEE, JAXB, XML]

keywords: JEE, JAX-WS, XML
description: custom XSD to resolv collision on JAXB
---
Integration always hides some surprises especially when it comes to old systems where quick solutions aren't the first aid. 
In this post, we present a strange and rare situation when requesting WS using an old existing WSDL. 
<!-- more -->
To make things simple bellow the wsdl and xsd samples : 

OldExistingWsService.wsdl
```xml
<!--?xml version="1.0" encoding="UTF-8"?-->
<!-- Published by JAX-WS RI at http://jax-ws.dev.java.net. RI's version is Metro/2.1-b25 (trunk-6664; 2010-12-31T11:31:15+0000) JAXWS-RI/2.2.3-promoted-b06 JAXWS/2.2. -->
<!-- Generated by JAX-WS RI at http://jax-ws.dev.java.net. RI's version is Metro/2.1-b25 (trunk-6664; 2010-12-31T11:31:15+0000) JAXWS-RI/2.2.3-promoted-b06 JAXWS/2.2. -->
<definitions xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd" xmlns:wsp="http://www.w3.org/ns/ws-policy" xmlns:wsp1_2="http://schemas.xmlsoap.org/ws/2004/09/policy" xmlns:wsam="http://www.w3.org/2007/05/addressing/metadata" xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/" xmlns:tns="http://ws.jtunisie.com/" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns="http://schemas.xmlsoap.org/wsdl/" targetnamespace="http://ws.jtunisie.com/" name="OldExistingWsService">
    <types>
        <xsd:schema>
            <xsd:import namespace="http://ws.jtunisie.com/" schemalocation="./OldExistingWsService.xsd">
        </xsd:import></xsd:schema>
    </types>
    <message name="oldOperation">
        <part name="parameters" element="tns:oldOperation">
    </part></message>
    <message name="oldOperationResponse">
        <part name="parameters" element="tns:oldOperationResponse">
    </part></message>
    <porttype name="OldExistingWs">
        <operation name="oldOperation">
            <input wsam:action="http://ws.jtunisie.com/OldExistingWs/oldOperationRequest" message="tns:oldOperation">
            <output wsam:action="http://ws.jtunisie.com/OldExistingWs/oldOperationResponse" message="tns:oldOperationResponse">
        </output></operation>
    </porttype>
    <binding name="OldExistingWsPortBinding" type="tns:OldExistingWs">
        <soap:binding transport="http://schemas.xmlsoap.org/soap/http" style="document">
        <operation name="oldOperation">
            <soap:operation soapaction="">
            <input>
                <soap:body use="literal">
             
            <output>
                <soap:body use="literal">
            </soap:body></output>
        </soap:body></soap:operation></operation>
    </soap:binding></binding>
    <service name="OldExistingWsService">
        <port name="OldExistingWsPort" binding="tns:OldExistingWsPortBinding">
            <soap:address location="http://ouertani:8080/Wsdlcustomisation/OldExistingWsService">
        </soap:address></port>
    </service>
</definitions>
```
OldExistingWsService.xsd
```xml
<!--?xml version="1.0" encoding="UTF-8"?-->
<!-- Published by JAX-WS RI at http://jax-ws.dev.java.net. RI's version is Metro/2.1-b25 (trunk-6664; 2010-12-31T11:31:15+0000) JAXWS-RI/2.2.3-promoted-b06 JAXWS/2.2. -->
<xs:schema xmlns:tns="http://ws.jtunisie.com/" xmlns:xs="http://www.w3.org/2001/XMLSchema" version="1.0" targetnamespace="http://ws.jtunisie.com/">
 
    <xs:element name="oldOperation" type="tns:oldOperation">
 
    <xs:element name="oldOperationResponse" type="tns:oldOperationResponse">
 
    <xs:complextype name="oldOperation">
        <xs:sequence>
            <xs:element name="parameter" type="tns:oldExsistingClass" minoccurs="0">
        </xs:element></xs:sequence>
    </xs:complextype>
 
    <xs:complextype name="oldExsistingClass">
        <xs:sequence>
            <xs:element name="a" type="xs:int">
            <xs:element name="_a" type="xs:int">
        </xs:element></xs:element></xs:sequence>
    </xs:complextype>
 
    <xs:complextype name="oldOperationResponse">
        <xs:sequence>
            <xs:element name="return" type="xs:int">
        </xs:element></xs:sequence>
    </xs:complextype>
</xs:element></xs:element></xs:schema>
```
trying to generate java client code from this wsdl will causes : <b>(wsdl2java.sh -client -d . -verbose OldExistingWsService.wsdl)</b>
<p style="color:red;">
 {% blockquote %}org.apache.cxf.tools.common.ToolException: Thrown by JAXB: Two declarations cause a collision in the ObjectFactory class. at line 17 column 1 of schema file:/OldExistingWsService.xsd
{% endblockquote %}
</p>
The problem is where a and _a are generate the same property, getter and setter methods names which generate exception.
<ol>By quick solution, I means :
<li>tell cxf to resolve name collision with : -autoNameResolution command line argument</li>
<li>tell jaxb to not remove underscores with : <a href="http://stackoverflow.com/questions/2163719/tell-jaxb-to-not-remove-underscores">jaxb:globalBindings underscoreBinding="asCharInWord"</a></li>
</ol>
As these tricks doesn't work for the current case, hands on dirty jaxb binding customization :
```
<jxb:bindings version="2.0" xmlns:jxb="http://java.sun.com/xml/ns/jaxb" xmlns:xs="http://www.w3.org/2001/XMLSchema">
  <jxb:bindings schemalocation="file:OldExistingWsService.xsd" node="/xs:schema">
 	<jxb:bindings node=".//xs:element[@name='_a']">
     <jxb:property name="oldA"></jxb:property>
    </jxb:bindings>
 </jxb:bindings>
</jxb:bindings>
```
And tell : 
 {% blockquote %} wsdl2java.sh -client -d . -verbose -b binding.xsd OldExistingWsService.wsdl 
{% endblockquote %}

Note : to deal with old wsdl I used this schema bindings :
```xml
<jaxws:bindings xmlns:jxb="http://java.sun.com/xml/ns/jaxb" xmlns="http://java.sun.com/xml/ns/jaxws" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:jaxws="http://java.sun.com/xm
l/ns/jaxws" wsdllocation="test.wsdl" xmlns:wsdl="http://schemas.xmlsoap.org/wsdl/" xmlns:tns1="VOLARISWS">
	<jaxws:schemabindings>
 		<jaxws:bindings node="wsdl:definitions">
  			<jaxws:bindings node=".//xs:element[@name='_a']">
     			<jxb:property name="oldA"></jxb:property>
   			</jaxws:bindings>
  		</jaxws:bindings>
 	</jaxws:schemabindings>
</jaxws:bindings>
```
thanks for patience.
