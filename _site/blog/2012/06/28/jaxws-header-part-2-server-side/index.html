<!DOCTYPE html>
<html lang="en">
<!-- Beautiful Jekyll 5.0.0 | Copyright Dean Attali 2020 -->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  

  

  <title>Jaxws Header : Part 2 : Server Side</title>

  
  <meta name="author" content="Slim Ouertani">
  

  <meta name="description" content="Purpose Manipulating JAXWS header on the server Side like reading WSS username token, logging saop message and publish a specific header. Introduction On Telecom IT environment and specially middelware solution web service communications are heavy used between solutions. This tutorial aims to introduce using handler on server side by publishing...">

  

  

  <link rel="alternate" type="application/rss+xml" title="Ouertani Personal Blog" href="/feed.xml">

  

  

  


  
    
      
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">


    
      
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css">


    
      
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic">


    
      
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800">


    
  

  
    
      <link rel="stylesheet" href="/assets/css/bootstrap-social.css">
    
      <link rel="stylesheet" href="/assets/css/beautifuljekyll.css">
    
  

  

  
  
  

  

  
  <meta property="og:site_name" content="Ouertani Personal Blog">
  <meta property="og:title" content="Jaxws Header : Part 2 : Server Side">
  <meta property="og:description" content="Purpose Manipulating JAXWS header on the server Side like reading WSS username token, logging saop message and publish a specific header. Introduction On Telecom IT environment and specially middelware solution web service communications are heavy used between solutions. This tutorial aims to introduce using handler on server side by publishing...">

  
  <meta property="og:image" content="/assets/img/avatar-icon.png">
  

  
  <meta property="og:type" content="article">
  <meta property="og:article:author" content="Slim Ouertani">
  <meta property="og:article:published_time" content="2012-06-28T03:19:00-04:00">
  <meta property="og:url" content="/blog/2012/06/28/jaxws-header-part-2-server-side/">
  <link rel="canonical" href="/blog/2012/06/28/jaxws-header-part-2-server-side/">
  

  
  <meta name="twitter:card" content="summary">
  
  <meta name="twitter:site" content="@ouertani">
  <meta name="twitter:creator" content="@ouertani">

  <meta property="twitter:title" content="Jaxws Header : Part 2 : Server Side">
  <meta property="twitter:description" content="Purpose Manipulating JAXWS header on the server Side like reading WSS username token, logging saop message and publish a specific header. Introduction On Telecom IT environment and specially middelware solution web service communications are heavy used between solutions. This tutorial aims to introduce using handler on server side by publishing...">

  
  <meta name="twitter:image" content="/assets/img/avatar-icon.png">
  

  


  

  

</head>


<body>

  


  <nav class="navbar navbar-expand-xl navbar-light fixed-top navbar-custom top-nav-regular"><a class="navbar-brand" href="">Ouertani Personal Blog</a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="main-navbar">
    <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link" href="/aboutme">About Me</a>
          </li></ul>
  </div>

  

  
    <div class="avatar-container">
      <div class="avatar-img-border">
        <a href="">
          <img alt="Navigation bar avatar" class="avatar-img" src="/assets/img/avatar-icon.png" />
        </a>
      </div>
    </div>
  

</nav>


  <!-- TODO this file has become a mess, refactor it -->







<header class="header-section ">

<div class="intro-header no-img">
  <div class="container-md">
    <div class="row">
      <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1">
        <div class="post-heading">
          <h1>Jaxws Header : Part 2 : Server Side</h1>
          

          
            <span class="post-meta">Posted on June 28, 2012</span>
            
            
          
        </div>
      </div>
    </div>
  </div>
</div>
</header>





<div class=" container-md ">
  <div class="row">
    <div class=" col-xl-8 offset-xl-2 col-lg-10 offset-lg-1 ">

      

      

      <article role="main" class="blog-post">
        <h2>Purpose</h2>

<p>Manipulating JAXWS header on the server Side like reading WSS username token, logging saop message and publish a specific header.</p>

<h2>Introduction</h2>

<p>On Telecom IT environment and specially middelware solution web service communications are heavy used between solutions. This tutorial aims to introduce using handler on server side by publishing specific header, reading WSS UserToken or logging the soap message on console.
<!-- more -->
This tutorial is Scala based, Java version can be easy translated.</p>

<h2>Parse undeclared custom header</h2>

<p>Letâ€™s consider We need to read WSS UserToken non published in our WSDL :</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;soapenv:Header&gt;</span>
      <span class="nt">&lt;wsse:Security</span>  <span class="na">xmlns:wsse=</span><span class="s">"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd"</span> <span class="na">xmlns:wsu=</span><span class="s">"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd"</span><span class="nt">&gt;</span>
         <span class="nt">&lt;wsse:UsernameToken</span> <span class="na">wsu:Id=</span><span class="s">"UsernameToken-1"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;wsse:Username&gt;</span>login<span class="nt">&lt;/wsse:Username&gt;</span>
            <span class="nt">&lt;wsse:Password</span> <span class="na">Type=</span><span class="s">"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText"</span><span class="nt">&gt;</span>XXXX<span class="nt">&lt;/wsse:Password&gt;</span>        
         <span class="nt">&lt;/wsse:UsernameToken&gt;</span>
      <span class="nt">&lt;/wsse:Security&gt;</span>
 <span class="nt">&lt;/soapenv:Header&gt;</span>
</code></pre></div></div>
<p>To parse this header we need to extend a SoapHandler, ovveride handle message class on put header and password on context, below a constant and full class</p>
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">object</span> <span class="nc">AuthenticationHandlerConstants</span> <span class="o">{</span>
 
  <span class="k">val</span> <span class="nv">REQUEST_USERID</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">"authn_userid"</span><span class="o">;</span>
  <span class="k">val</span> <span class="nv">REQUEST_PASSWORD</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">"authn_password"</span><span class="o">;</span>
  <span class="k">val</span> <span class="nv">AUTHN_PREFIX</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">"wsse"</span><span class="o">;</span>
  <span class="k">val</span> <span class="nv">AUTHN_LNAME</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">"Security"</span><span class="o">;</span>
  <span class="k">val</span> <span class="nv">AUTHN_URI</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd"</span><span class="o">;</span>
  <span class="k">val</span> <span class="nv">AUTHN_STAUTS</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">"authnStatus"</span><span class="o">;</span>
 
  <span class="k">val</span> <span class="nv">LOGIN</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">"login"</span>
  <span class="k">val</span> <span class="nv">PWD</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">"passwd"</span>
<span class="o">}</span>
</code></pre></div></div>
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">java.io.PrintStream</span><span class="o">;</span>
<span class="k">import</span> <span class="nn">java.util.HashSet</span><span class="o">;</span>
<span class="k">import</span> <span class="nn">java.util.Iterator</span><span class="o">;</span>
<span class="k">import</span> <span class="nn">java.util.Set</span><span class="o">;</span>
<span class="k">import</span> <span class="nn">javax.xml.namespace.QName</span><span class="o">;</span>
<span class="k">import</span> <span class="nn">javax.xml.soap.SOAPElement</span><span class="o">;</span>
 
<span class="k">import</span> <span class="nn">javax.xml.soap.SOAPHeader</span><span class="o">;</span>
<span class="k">import</span> <span class="nn">javax.xml.ws.handler.MessageContext</span><span class="o">;</span>
<span class="k">import</span> <span class="nn">javax.xml.ws.handler.soap.SOAPHandler</span><span class="o">;</span>
<span class="k">import</span> <span class="nn">javax.xml.ws.handler.soap.SOAPMessageContext</span><span class="o">;</span>
<span class="k">import</span> <span class="nn">org.apache.log4j.Logger</span><span class="o">;</span>
 
<span class="cm">/**
 * @author Slim Ouertani
 */</span>
<span class="k">class</span> <span class="nc">SecuritySOAPHandler</span> <span class="k">extends</span> <span class="nc">SOAPHandler</span><span class="o">[</span><span class="kt">SOAPMessageContext</span><span class="o">]</span> <span class="o">{</span>
 
  <span class="k">private</span> <span class="k">val</span> <span class="nv">L</span> <span class="k">=</span> <span class="nv">Logger</span><span class="o">.</span><span class="py">getLogger</span><span class="o">(</span><span class="n">classOf</span><span class="o">[</span><span class="kt">SecuritySOAPHandler</span><span class="o">]);</span>
 
  <span class="k">override</span> <span class="k">def</span> <span class="nf">getHeaders</span><span class="o">()</span><span class="k">:</span> <span class="kt">Set</span><span class="o">[</span><span class="kt">QName</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">val</span> <span class="nv">securityHeader</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">QName</span><span class="o">(</span><span class="s">"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd"</span><span class="o">,</span> <span class="s">"Security"</span><span class="o">,</span> <span class="s">"wsse"</span><span class="o">);</span>
    <span class="k">val</span> <span class="nv">headers</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">HashSet</span><span class="o">[</span><span class="kt">QName</span><span class="o">]();</span>
    <span class="nv">headers</span><span class="o">.</span><span class="py">add</span><span class="o">(</span><span class="n">securityHeader</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">headers</span><span class="o">;</span>
  <span class="o">}</span>
 
  <span class="k">override</span> <span class="k">def</span> <span class="nf">handleMessage</span><span class="o">(</span><span class="n">soapMessageContext</span><span class="k">:</span> <span class="kt">SOAPMessageContext</span><span class="o">)</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="o">{</span>
 
    <span class="k">try</span> <span class="o">{</span>
      <span class="k">val</span> <span class="nv">outMessageIndicator</span> <span class="k">=</span> <span class="nv">soapMessageContext</span><span class="o">.</span><span class="py">get</span><span class="o">(</span><span class="nv">MessageContext</span><span class="o">.</span><span class="py">MESSAGE_OUTBOUND_PROPERTY</span><span class="o">).</span><span class="py">asInstanceOf</span><span class="o">[</span><span class="kt">Boolean</span><span class="o">];</span>
      <span class="nf">if</span> <span class="o">(!</span><span class="n">outMessageIndicator</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">val</span> <span class="nv">envelope</span> <span class="k">=</span> <span class="nv">soapMessageContext</span><span class="o">.</span><span class="py">getMessage</span><span class="o">().</span><span class="py">getSOAPPart</span><span class="o">().</span><span class="py">getEnvelope</span><span class="o">()</span>
        <span class="k">val</span> <span class="nv">header</span> <span class="k">=</span> <span class="nv">envelope</span><span class="o">.</span><span class="py">getHeader</span><span class="o">()</span>
 
        <span class="nf">if</span> <span class="o">(</span><span class="n">header</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
          <span class="nv">L</span><span class="o">.</span><span class="py">warn</span><span class="o">(</span><span class="s">"No headers found in the input SOAP request"</span><span class="o">)</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
          <span class="nf">processSOAPHeader</span><span class="o">(</span><span class="n">header</span><span class="o">)</span> <span class="k">match</span> <span class="o">{</span>
            <span class="k">case</span> <span class="nc">Some</span><span class="o">(</span><span class="nc">_processSOAPHeader</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="o">{</span>
              <span class="nv">soapMessageContext</span><span class="o">.</span><span class="py">put</span><span class="o">(</span><span class="nv">AuthenticationHandlerConstants</span><span class="o">.</span><span class="py">AUTHN_STAUTS</span><span class="o">,</span> <span class="nv">java</span><span class="o">.</span><span class="py">lang</span><span class="o">.</span><span class="py">Boolean</span><span class="o">.</span><span class="py">TRUE</span><span class="o">);</span>
              <span class="nv">soapMessageContext</span><span class="o">.</span><span class="py">put</span><span class="o">(</span><span class="nv">AuthenticationHandlerConstants</span><span class="o">.</span><span class="py">LOGIN</span><span class="o">,</span> <span class="nv">_processSOAPHeader</span><span class="o">.</span><span class="py">_1</span><span class="o">);</span>
              <span class="nv">soapMessageContext</span><span class="o">.</span><span class="py">put</span><span class="o">(</span><span class="nv">AuthenticationHandlerConstants</span><span class="o">.</span><span class="py">PWD</span><span class="o">,</span> <span class="nv">_processSOAPHeader</span><span class="o">.</span><span class="py">_2</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="k">case</span> <span class="nc">None</span> <span class="k">=&gt;</span> <span class="o">{</span>
              <span class="nv">soapMessageContext</span><span class="o">.</span><span class="py">put</span><span class="o">(</span><span class="nv">AuthenticationHandlerConstants</span><span class="o">.</span><span class="py">AUTHN_STAUTS</span><span class="o">,</span> <span class="nv">java</span><span class="o">.</span><span class="py">lang</span><span class="o">.</span><span class="py">Boolean</span><span class="o">.</span><span class="py">FALSE</span><span class="o">);</span>
              <span class="nv">soapMessageContext</span><span class="o">.</span><span class="py">put</span><span class="o">(</span><span class="nv">AuthenticationHandlerConstants</span><span class="o">.</span><span class="py">LOGIN</span><span class="o">,</span> <span class="s">""</span><span class="o">);</span>
              <span class="nv">soapMessageContext</span><span class="o">.</span><span class="py">put</span><span class="o">(</span><span class="nv">AuthenticationHandlerConstants</span><span class="o">.</span><span class="py">PWD</span><span class="o">,</span> <span class="s">""</span><span class="o">);</span>
            <span class="o">}</span>
          <span class="o">}</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">{</span>
      <span class="k">case</span> <span class="n">ex</span><span class="k">:</span> <span class="kt">Exception</span> <span class="o">=&gt;</span> <span class="nv">L</span><span class="o">.</span><span class="py">error</span><span class="o">(</span><span class="nv">ex</span><span class="o">.</span><span class="py">getMessage</span><span class="o">(),</span> <span class="n">ex</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="nv">soapMessageContext</span><span class="o">.</span><span class="py">setScope</span><span class="o">(</span><span class="nv">AuthenticationHandlerConstants</span><span class="o">.</span><span class="py">AUTHN_STAUTS</span><span class="o">,</span> <span class="nv">MessageContext</span><span class="o">.</span><span class="py">Scope</span><span class="o">.</span><span class="py">APPLICATION</span><span class="o">);</span>
    <span class="nv">soapMessageContext</span><span class="o">.</span><span class="py">setScope</span><span class="o">(</span><span class="nv">AuthenticationHandlerConstants</span><span class="o">.</span><span class="py">LOGIN</span><span class="o">,</span> <span class="nv">MessageContext</span><span class="o">.</span><span class="py">Scope</span><span class="o">.</span><span class="py">APPLICATION</span><span class="o">);</span>
    <span class="nv">soapMessageContext</span><span class="o">.</span><span class="py">setScope</span><span class="o">(</span><span class="nv">AuthenticationHandlerConstants</span><span class="o">.</span><span class="py">PWD</span><span class="o">,</span> <span class="nv">MessageContext</span><span class="o">.</span><span class="py">Scope</span><span class="o">.</span><span class="py">APPLICATION</span><span class="o">);</span>
    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
  <span class="o">}</span>
 
  <span class="k">private</span> <span class="k">def</span> <span class="nf">processSOAPHeaderInfo</span><span class="o">(</span><span class="n">e</span><span class="k">:</span> <span class="kt">SOAPElement</span><span class="o">)</span><span class="k">:</span> <span class="o">(</span><span class="kt">String</span><span class="o">,</span><span class="kt">String</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">var</span> <span class="nc">_id</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="kc">null</span>
    <span class="k">var</span> <span class="nc">_password</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="kc">null</span>
 
    <span class="k">val</span> <span class="nv">childElements</span> <span class="k">=</span> <span class="nv">e</span><span class="o">.</span><span class="py">getChildElements</span><span class="o">(</span><span class="k">new</span> <span class="nc">QName</span><span class="o">(</span><span class="nv">AuthenticationHandlerConstants</span><span class="o">.</span><span class="py">AUTHN_URI</span><span class="o">,</span> <span class="s">"UsernameToken"</span><span class="o">));</span>
    <span class="nf">while</span> <span class="o">(</span><span class="nv">childElements</span><span class="o">.</span><span class="py">hasNext</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">val</span> <span class="nv">usernameToken</span> <span class="k">=</span> <span class="nv">childElements</span><span class="o">.</span><span class="py">next</span><span class="o">();</span>
      <span class="c1">// loop through child elements</span>
 
      <span class="n">usernameToken</span> <span class="k">match</span> <span class="o">{</span>
 
        <span class="k">case</span> <span class="n">child</span><span class="k">:</span> <span class="kt">SOAPElement</span> <span class="o">=&gt;</span> <span class="o">{</span>
 
          <span class="k">val</span> <span class="nv">childElements1</span> <span class="k">=</span> <span class="nv">child</span><span class="o">.</span><span class="py">getChildElements</span><span class="o">(</span><span class="k">new</span> <span class="nc">QName</span><span class="o">(</span><span class="nv">AuthenticationHandlerConstants</span><span class="o">.</span><span class="py">AUTHN_URI</span><span class="o">,</span> <span class="s">"Username"</span><span class="o">));</span>
          <span class="k">val</span> <span class="nv">childElements2</span> <span class="k">=</span> <span class="nv">child</span><span class="o">.</span><span class="py">getChildElements</span><span class="o">(</span><span class="k">new</span> <span class="nc">QName</span><span class="o">(</span><span class="nv">AuthenticationHandlerConstants</span><span class="o">.</span><span class="py">AUTHN_URI</span><span class="o">,</span> <span class="s">"Password"</span><span class="o">));</span>
 
          <span class="nf">while</span> <span class="o">(</span><span class="nv">childElements1</span><span class="o">.</span><span class="py">hasNext</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">val</span> <span class="nv">next</span> <span class="k">=</span> <span class="nv">childElements1</span><span class="o">.</span><span class="py">next</span><span class="o">();</span>
            <span class="n">next</span> <span class="k">match</span> <span class="o">{</span>
              <span class="k">case</span> <span class="n">l</span><span class="k">:</span> <span class="kt">SOAPElement</span> <span class="o">=&gt;</span> <span class="o">{</span>
                <span class="k">val</span> <span class="nv">value</span> <span class="k">=</span> <span class="nv">l</span><span class="o">.</span><span class="py">getValue</span><span class="o">();</span>
 
                <span class="nc">_id</span> <span class="k">=</span> <span class="n">value</span><span class="o">;</span>
              <span class="o">}</span>
            <span class="o">}</span>
          <span class="o">}</span>
          <span class="nf">while</span> <span class="o">(</span><span class="nv">childElements2</span><span class="o">.</span><span class="py">hasNext</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">val</span> <span class="nv">next</span> <span class="k">=</span> <span class="nv">childElements2</span><span class="o">.</span><span class="py">next</span><span class="o">();</span>
            <span class="n">next</span> <span class="k">match</span> <span class="o">{</span>
              <span class="k">case</span> <span class="n">l</span><span class="k">:</span> <span class="kt">SOAPElement</span> <span class="o">=&gt;</span> <span class="o">{</span>
                <span class="k">val</span> <span class="nv">value</span> <span class="k">=</span> <span class="nv">l</span><span class="o">.</span><span class="py">getValue</span><span class="o">()</span>
 
                <span class="nc">_password</span> <span class="k">=</span> <span class="n">value</span><span class="o">;</span>
              <span class="o">}</span>
            <span class="o">}</span>
          <span class="o">}</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">}</span>
    <span class="nf">return</span> <span class="o">(</span><span class="nc">_id</span><span class="o">,</span> <span class="nc">_password</span><span class="o">);</span>
  <span class="o">}</span>
 
  <span class="k">private</span> <span class="k">def</span> <span class="nf">processSOAPHeader</span><span class="o">(</span><span class="n">sh</span><span class="k">:</span> <span class="kt">SOAPHeader</span><span class="o">)</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[(</span><span class="kt">String</span>,<span class="kt">String</span><span class="o">)]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">var</span> <span class="n">authenticated</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[(</span><span class="kt">String</span>,<span class="kt">String</span><span class="o">)]</span> <span class="k">=</span> <span class="nc">None</span>
 
    <span class="k">val</span> <span class="nv">childElems</span> <span class="k">=</span> <span class="nv">sh</span><span class="o">.</span><span class="py">getChildElements</span><span class="o">(</span><span class="k">new</span> <span class="nc">QName</span><span class="o">(</span>
      <span class="nv">AuthenticationHandlerConstants</span><span class="o">.</span><span class="py">AUTHN_URI</span><span class="o">,</span>
      <span class="nv">AuthenticationHandlerConstants</span><span class="o">.</span><span class="py">AUTHN_LNAME</span><span class="o">));</span>
 
    <span class="c1">// iterate through child elements</span>
    <span class="nf">while</span> <span class="o">(</span><span class="nv">childElems</span><span class="o">.</span><span class="py">hasNext</span><span class="o">())</span> <span class="o">{</span>
 
      <span class="k">val</span> <span class="nv">child</span> <span class="k">=</span> <span class="nv">childElems</span><span class="o">.</span><span class="py">next</span><span class="o">().</span><span class="py">asInstanceOf</span><span class="o">[</span><span class="kt">SOAPElement</span><span class="o">]</span>
      <span class="n">authenticated</span> <span class="k">=</span> <span class="nc">Some</span><span class="o">(</span><span class="nf">processSOAPHeaderInfo</span><span class="o">(</span><span class="n">child</span><span class="o">))</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">authenticated</span>
  <span class="o">}</span>
 
  <span class="k">override</span> <span class="k">def</span> <span class="nf">handleFault</span><span class="o">(</span><span class="n">soapMessageContext</span><span class="k">:</span> <span class="kt">SOAPMessageContext</span><span class="o">)</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="kc">false</span>
<span class="o">}</span>
</code></pre></div></div>
<p>Unlike client side we need to add an xml file handler.xml to enable the previous handler</p>
<h3>on web service declaration: </h3>
<ol>
	<li>Chain this handler : @HandlerChain(file = "handler.xml")</li>
	<li>Inject WebServiceContext : @Resource private var wsContext: WebServiceContext = _</li>
	<li>Retrieve a messageContext : val msgContext = wsContext.getMessageContext()</li>
	<li>Check stored valued : val authnStatus = msgContext.get(AuthenticationHandlerConstants.AUTHN_STAUTS)</li>
</ol>
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@WebService</span><span class="o">(</span><span class="n">serviceName</span> <span class="k">=</span> <span class="s">"WsService"</span><span class="o">,</span> <span class="n">targetNamespace</span> <span class="k">=</span> <span class="s">"http://slim.ouertani.me)
@HandlerChain(file = "</span><span class="nv">handler</span><span class="o">.</span><span class="py">xml</span><span class="s">")
@Stateless()
@Interceptors(Array(classOf[TracingInterceptor]))
class WsService extends LogHelper{
   
  @Resource private var wsContext: WebServiceContext = _
 
  def authenticate() {
 
    val msgContext = wsContext.getMessageContext()
    val authnStatus = msgContext.get(AuthenticationHandlerConstants.AUTHN_STAUTS)
    if (authnStatus == null || !authnStatus.asInstanceOf[Boolean]) {
       L.warn("</span><span class="n">header</span> <span class="n">authentification</span> <span class="n">not</span> <span class="n">found</span><span class="s">");
      throw AuthenticationHeaderNotFound.toFaultResponse
    }
 
    try {
      val login = msgContext.get("</span><span class="n">login</span><span class="s">").asInstanceOf[String]
      val passwd = msgContext.get("</span><span class="n">passwd</span><span class="s">").asInstanceOf[String]
      L.info("</span><span class="n">user</span> <span class="s">" + login + "</span><span class="n">pwd</span><span class="s">" + passwd + "</span><span class="k">try</span> <span class="k">this</span> <span class="n">service</span><span class="s">")
    } catch {
      case ex: Exception =&gt;
        L.warn("</span> <span class="n">exception</span> <span class="n">to</span> <span class="n">parse</span> <span class="n">header</span> <span class="n">authentification</span><span class="err">"</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>
        <span class="k">throw</span> <span class="nv">AuthenticationHeaderNotFound</span><span class="o">.</span><span class="py">toFaultResponse</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h2>Adding custom header</h2>

<ol>Publishing a custom header is easier than using the previous handler :

<li>First lets add a custom header class</li> 
``` scala
import scala.reflect.BeanProperty
import javax.xml.bind.annotation.{XmlType , XmlAccessType, XmlElement, XmlAccessorType};
/**
 * @author Slim Ouertani
 */
@XmlAccessorType(XmlAccessType.FIELD)
@XmlType(name = "Header", propOrder = Array(
    "username",
    "password"
  ))
class UsernameToken {
   @BeanProperty  @XmlElement(required = true, nillable = false ) var username : String= ""
   @BeanProperty  @XmlElement(required = true, nillable = false ) var password : String= ""
}
```

<li>publish this header using @WebParam (name = "usernameToken",header = true)</li>
``` scala
def execute (@WebParam(name = "request" ) request : Request, @WebParam (name = "usernameToken",header = true) header) {
  ....
 }
```
<li>retrieving user and password field are the same as accessing class properties :</li>
``` scala
val username = ""+header.getUsername()
val password = ""+header.getPassword()
```
<li>note that the preceding header is declared on WSDL method and produce this output on soapUI interface </li></ol>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;soapenv:Header&gt;</span>
      <span class="nt">&lt;ws:usernameToken&gt;</span>
         <span class="nt">&lt;username&gt;</span>login<span class="nt">&lt;/username&gt;</span>
         <span class="nt">&lt;password&gt;</span>XXXXX<span class="nt">&lt;/password&gt;</span>
      <span class="nt">&lt;/ws:usernameToken&gt;</span>
<span class="nt">&lt;/soapenv:Header&gt;</span>
</code></pre></div></div>
<h2>Conclusion</h2>

<p>Publishing specific header using JAX-WS is easier than using handler. Otherwise, handlers on server side are helpful for other purpose like logging I/O message.</p>

      </article>

      

      

      
        <!-- Check if any share-links are active -->




<section id = "social-share-section">
  <span class="sr-only">Share: </span>

  
    <a href="https://twitter.com/intent/tweet?text=Jaxws+Header+%3A+Part+2+%3A+Server+Side&url=%2Fblog%2F2012%2F06%2F28%2Fjaxws-header-part-2-server-side%2F"
      class="btn btn-social-icon btn-twitter" title="Share on Twitter">
      <span class="fab fa-fw fa-twitter" aria-hidden="true"></span>
      <span class="sr-only">Twitter</span>
    </a>
  

  
    <a href="https://www.facebook.com/sharer/sharer.php?u=%2Fblog%2F2012%2F06%2F28%2Fjaxws-header-part-2-server-side%2F"
      class="btn btn-social-icon btn-facebook" title="Share on Facebook">
      <span class="fab fa-fw fa-facebook" aria-hidden="true"></span>
      <span class="sr-only">Facebook</span>
    </a>
  

  
    <a href="https://www.linkedin.com/shareArticle?mini=true&url=%2Fblog%2F2012%2F06%2F28%2Fjaxws-header-part-2-server-side%2F"
      class="btn btn-social-icon btn-linkedin" title="Share on LinkedIn">
      <span class="fab fa-fw fa-linkedin" aria-hidden="true"></span>
      <span class="sr-only">LinkedIn</span>
    </a>
  

  

</section>



      

      <ul class="pagination blog-pager">
        
        <li class="page-item previous">
          <a class="page-link" href="/blog/2012/06/28/sending-an-email-using-the-javamail-session-and-glassfish/" data-toggle="tooltip" data-placement="top" title="Sending an Email using the JavaMail Session and Glassfish">&larr; Previous Post</a>
        </li>
        
        
        <li class="page-item next">
          <a class="page-link" href="/blog/2012/06/29/xml-rpc-using-scala/" data-toggle="tooltip" data-placement="top" title="XML-RPC using scala">Next Post &rarr;</a>
        </li>
        
      </ul>
      
  
  
  

  




    </div>
  </div>
</div>


  <footer>
  <div class="container-md beautiful-jekyll-footer">
    <div class="row">
      <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1">
      <ul class="list-inline text-center footer-links"><li class="list-inline-item">
    <a href="/feed.xml" title="RSS">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">RSS</span>
    </a>
  </li><li class="list-inline-item">
    <a href="mailto:ouertani@gmail.com" title="Email me">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">Email me</span>
   </a>
  </li><li class="list-inline-item">
    <a href="https://github.com/ouertani" title="GitHub">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fab fa-github fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">GitHub</span>
   </a>
  </li><li class="list-inline-item">
    <a href="https://twitter.com/ouertani" title="Twitter">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">Twitter</span>
   </a>
  </li></ul>

      
      <p class="copyright text-muted">
      
        Slim Ouertani
        &nbsp;&bull;&nbsp;
      
      2021

      

      
      </p>
      <p class="theme-by text-muted">
        Powered by
        <a href="https://beautifuljekyll.com">Beautiful Jekyll</a>
      </p>
      </div>
    </div>
  </div>
</footer>


  
  
    
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs=" crossorigin="anonymous"></script>


  
    
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>


  
    
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>


  



  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
      <script src="/assets/js/beautifuljekyll.js"></script>
    
  









</body>
</html>
